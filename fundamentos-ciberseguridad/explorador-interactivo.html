<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Mando de Ciberseguridad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #1c1917; /* stone-900 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { .chart-container { height: 350px; max-height: 400px; } }
        .nav-link { transition: color 0.3s, border-bottom-color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #0d9488; border-bottom-color: #0d9488; }
        .tab-button.active { background-color: #0d9488; color: white; }
        .cycle-step { transition: transform 0.2s, background-color 0.2s; }
        .cycle-step:hover { transform: scale(1.05); }
        .cycle-step.active { background-color: #0d9488; color: white; transform: scale(1.1); }
        
        /* Estilos para Gamificaci√≥n */
        .lab-option { transition: background-color 0.3s, border-color 0.3s, color 0.3s; cursor: pointer; }
        .lab-option.correct { background-color: #10b981; border-color: #059669; color: white; }
        .lab-option.incorrect { background-color: #ef4444; border-color: #dc2626; color: white; }
        .email-red-flag { cursor: pointer; background-color: rgba(255, 235, 59, 0.3); padding: 0 2px; border-radius: 3px; }
        .email-red-flag:hover { background-color: rgba(255, 235, 59, 0.6); }
    </style>
</head>
<body class="antialiased">

    <header class="bg-stone-100 shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-teal-700">Centro de Mando Cibersec</h1>
            <div class="hidden md:flex space-x-6">
                <a href="#introduccion" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Intel Briefing</a>
                <a href="#conceptos" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Conceptos Clave</a>
                <a href="#riesgos" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Gesti√≥n de Riesgos</a>
                <a href="#vuln-ameacas" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Amenazas</a>
                <a href="#cloud" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Nube</a>
                <a href="#laboratorio" class="nav-link font-bold text-yellow-600 border-b-2 border-transparent pb-1">LABORATORIO</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-stone-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="#introduccion" class="block py-2 px-4 text-sm text-stone-600 hover:bg-stone-200">Intel Briefing</a>
            <a href="#conceptos" class="block py-2 px-4 text-sm text-stone-600 hover:bg-stone-200">Conceptos Clave</a>
            <a href="#riscos" class="block py-2 px-4 text-sm text-stone-600 hover:bg-stone-200">Gesti√≥n de Riesgos</a>
            <a href="#vuln-ameacas" class="block py-2 px-4 text-sm text-stone-600 hover:bg-stone-200">Amenazas</a>
            <a href="#cloud" class="block py-2 px-4 text-sm text-stone-600 hover:bg-stone-200">Nube</a>
            <a href="#laboratorio" class="block py-2 px-4 text-sm font-bold text-yellow-600 hover:bg-stone-200">LABORATORIO</a>
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">

        <section id="introduccion" class="text-center mb-20">
            <h2 class="text-4xl font-bold text-stone-800 mb-4">Bienvenido al Centro de Mando</h2>
            <p class="text-lg text-stone-600 max-w-3xl mx-auto">
                La teor√≠a solo te lleva hasta cierto punto. Aqu√≠, aplicar√°s los conceptos del documento "Riesgos, vulnerabilidades y amenazas" a escenarios reales. Tu objetivo: pasar de estudiante a analista.
            </p>
        </section>

        <section id="conceptos" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-stone-800 mb-2">Pilares y Estrategias</h2>
            <p class="text-center text-stone-600 mb-12">Todo sistema de seguridad se basa en conceptos y pol√≠ticas fundamentales. Dom√≠nalos.</p>
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-yellow-400">
                    <h3 class="font-bold text-xl mb-2">Confidencialidad</h3>
                    <p class="text-stone-600">Garantiza que la informaci√≥n solo sea accesible para personal autorizado. Es el pilar de la privacidad.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500">
                    <h3 class="font-bold text-xl mb-2">Integridad</h3>
                    <p class="text-stone-600">Asegura que la informaci√≥n no ha sido alterada de forma no autorizada durante su almacenamiento o transmisi√≥n.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
                    <h3 class="font-bold text-xl mb-2">Disponibilidad</h3>
                    <p class="text-stone-600">Asegura que los sistemas y los datos est√©n operativos y accesibles para los usuarios cuando se necesiten.</p>
                </div>
            </div>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <h3 class="text-2xl font-bold text-center mb-6">Paradigmas de Pol√≠ticas de Seguridad</h3>
                <div id="policy-tabs" class="flex justify-center space-x-2 sm:space-x-4 mb-6 bg-stone-100 p-2 rounded-full">
                    <button data-policy="permisiva" class="tab-button px-4 py-2 text-sm sm:text-base rounded-full transition active">Permisiva</button>
                    <button data-policy="prudente" class="tab-button px-4 py-2 text-sm sm:text-base rounded-full transition">Prudente</button>
                    <button data-policy="paranoica" class="tab-button px-4 py-2 text-sm sm:text-base rounded-full transition">Paranoica</button>
                </div>
                <div id="policy-content" class="text-center text-stone-700 min-h-[120px]"></div>
            </div>
        </section>

        <section id="riscos" class="mb-20">
            <h2 class="text-3xl font-bold text-center text-stone-800 mb-2">El Ciclo de Gesti√≥n de Riesgos</h2>
            <p class="text-center text-stone-600 mb-12">La gesti√≥n de riesgos es un proceso continuo, no un evento √∫nico. Haz clic en cada fase del ciclo de Magerit para entender su prop√≥sito.</p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16">
                <div class="relative w-80 h-80 flex items-center justify-center">
                    <div id="step-1" data-content="risk-content-1" class="cycle-step absolute cursor-pointer bg-white shadow-lg rounded-full w-32 h-32 flex items-center justify-center text-center p-2 font-semibold" style="transform: translate(0, -100px);">Identificar Activos y Amenazas</div>
                    <div id="step-2" data-content="risk-content-2" class="cycle-step absolute cursor-pointer bg-white shadow-lg rounded-full w-32 h-32 flex items-center justify-center text-center p-2 font-semibold" style="transform: translate(100px, 0);">Evaluar Riesgo (Prob. x Impacto)</div>
                    <div id="step-3" data-content="risk-content-3" class="cycle-step absolute cursor-pointer bg-white shadow-lg rounded-full w-32 h-32 flex items-center justify-center text-center p-2 font-semibold" style="transform: translate(0, 100px);">Tratar el Riesgo</div>
                    <div id="step-4" data-content="risk-content-4" class="cycle-step absolute cursor-pointer bg-white shadow-lg rounded-full w-32 h-32 flex items-center justify-center text-center p-2 font-semibold" style="transform: translate(-100px, 0);">Monitorizar y Revisar</div>
                    <div class="w-40 h-40 bg-teal-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-inner">Ciclo PDCA</div>
                </div>
                <div class="w-full md:w-1/2 bg-white p-6 rounded-lg shadow-lg min-h-[220px]">
                    <div id="risk-content-area"></div>
                </div>
            </div>
        </section>

        <section id="vuln-ameacas" class="mb-20">
             <h2 class="text-3xl font-bold text-center text-stone-800 mb-2">Vulnerabilidades vs. Amenazas</h2>
            <p class="text-center text-stone-600 mb-12">Aunque relacionados, estos conceptos son distintos. Una amenaza explota una vulnerabilidad.</p>
            <div class="grid lg:grid-cols-2 gap-12">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-4">Vulnerabilidades: Las Debilidades</h3>
                    <p class="text-stone-600 mb-6">Son fallos o debilidades en un sistema que pueden ser explotados. El gr√°fico muestra las causas m√°s comunes.</p>
                    <div class="chart-container"><canvas id="vulnerabilitiesChart"></canvas></div>
                </div>
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-2xl font-bold mb-4">Amenazas: Las Causas Potenciales</h3>
                    <p class="text-stone-600 mb-6">Es cualquier evento que puede causar da√±o a un activo. Se clasifican seg√∫n su origen.</p>
                    <div class="space-y-4">
                        <div class="bg-stone-100 p-4 rounded-md"><h4 class="font-semibold">üå™Ô∏è Desastres Naturales</h4><p class="text-sm text-stone-600">Eventos sin intervenci√≥n humana como terremotos o inundaciones.</p></div>
                        <div class="bg-stone-100 p-4 rounded-md"><h4 class="font-semibold">üè≠ Origen Industrial</h4><p class="text-sm text-stone-600">Incidentes derivados de la actividad humana, como fallos el√©ctricos.</p></div>
                        <div class="bg-stone-100 p-4 rounded-md"><h4 class="font-semibold">üêõ Defectos de Aplicaciones</h4><p class="text-sm text-stone-600">Errores no intencionados en el dise√±o o implementaci√≥n de software.</p></div>
                         <div class="bg-stone-100 p-4 rounded-md"><h4 class="font-semibold">üë§ Acciones Deliberadas</h4><p class="text-sm text-stone-600">Ataques intencionados de actores maliciosos para causar da√±o.</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="cloud" class="mb-12">
            <h2 class="text-3xl font-bold text-center text-stone-800 mb-2">Seguridad en la Nube</h2>
            <p class="text-center text-stone-600 mb-12">La nube cambia las reglas del juego. El modelo de responsabilidad compartida es clave: ¬øqui√©n es responsable de qu√©?</p>
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <div class="flex justify-center space-x-2 sm:space-x-4 mb-6">
                    <button id="iaas-btn" class="cloud-btn px-4 py-2 text-sm sm:text-base border-2 border-teal-600 rounded-full transition text-teal-600">IaaS</button>
                    <button id="paas-btn" class="cloud-btn px-4 py-2 text-sm sm:text-base border-2 border-teal-600 rounded-full transition text-teal-600">PaaS</button>
                    <button id="saas-btn" class="cloud-btn px-4 py-2 text-sm sm:text-base border-2 border-teal-600 rounded-full transition text-teal-600">SaaS</button>
                </div>
                <p id="cloud-description" class="text-center text-stone-600 mb-6 min-h-[40px]"></p>
                <div class="chart-container mx-auto" style="max-width: 700px; height: 400px;"><canvas id="cloudResponsibilityChart"></canvas></div>
            </div>
        </section>
        
        <!-- #################### LABORATORIO DE SIMULACI√ìN #################### -->
        <section id="laboratorio" class="pt-12">
            <div class="bg-gray-800 text-white p-8 rounded-lg shadow-2xl border-t-4 border-yellow-400">
                <h2 class="text-3xl font-bold text-center text-yellow-400 mb-2">Laboratorio de Simulaci√≥n</h2>
                <p class="text-center text-stone-300 mb-8">Aqu√≠ es donde el conocimiento se convierte en habilidad. Prep√°rate.</p>
                
                <div class="bg-black/50 p-6 rounded-lg">
                    <h3 class="text-2xl font-bold mb-4 border-b border-yellow-400/50 pb-2">Incidente 01: El Phishing del CEO</h3>
                    <p class="text-stone-300 mb-6"><strong>Briefing:</strong> Analista, hemos recibido una alerta. Un email sospechoso est√° circulando, suplantando al CEO. Tu misi√≥n: analizar la evidencia, identificar los Indicadores de Compromiso (IoCs) y determinar el riesgo. No falles.</p>

                    <div id="lab-feedback" class="mb-4 p-3 rounded-md text-center font-semibold hidden"></div>

                    <h4 class="font-bold text-lg mb-4 text-stone-200">Evidencia: Email Recibido</h4>
                    <div class="bg-white text-stone-900 p-4 rounded-md font-mono text-sm border-l-4 border-gray-300">
                        <p><strong>De:</strong> <span class="email-red-flag" data-feedback="¬°Correcto! El dominio 'secure-mail-ceo.com' es sospechoso y no coincide con el dominio oficial de la empresa. Un analista siempre verifica la legitimidad del remitente.">"CEO" &lt;ceo@secure-mail-ceo.com&gt;</span></p>
                        <p><strong>Para:</strong> equipo@miempresa.com</p>
                        <p><strong>Asunto:</strong> <span class="email-red-flag" data-feedback="¬°Bien visto! La urgencia y la presi√≥n son t√°cticas cl√°sicas de ingenier√≠a social para hacer que las v√≠ctimas act√∫en sin pensar.">URGENTE: Transferencia bancaria requerida</span></p>
                        <hr class="my-2">
                        <p>Equipo,</p>
                        <p>Necesito que realicen una transferencia urgente para un nuevo proveedor. Es un asunto confidencial y de m√°xima prioridad. <span class="email-red-flag" data-feedback="Correcto. Los enlaces acortados o que no coinciden con el texto son una bandera roja masiva. Siempre se debe pasar el rat√≥n por encima para verificar la URL real antes de hacer clic.">Hagan clic aqu√≠ para ver los detalles de la factura.</span></p>
                        <p>Espero confirmaci√≥n inmediata.</p>
                        <p>Gracias,</p>
                        <p>El CEO</p>
                    </div>
                    <p class="text-xs text-stone-400 mt-2"><i>Instrucci√≥n: Haz clic en las partes del email que consideres sospechosas para analizarlas.</i></p>

                    <div class="mt-8">
                        <h4 class="font-bold text-lg mb-4 text-stone-200">An√°lisis T√°ctico</h4>
                        <div id="lab-question-area">
                           <!-- Las preguntas del laboratorio se cargar√°n aqu√≠ -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-stone-200 mt-20">
        <div class="container mx-auto px-6 py-4 text-center text-stone-600">
            <p>&copy; 2025 Centro de Mando de Ciberseguridad. Creado a partir del documento PID_00290978.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    const policyContent = {
        permisiva: { title: "Pol√≠tica Permisiva", text: "Empieza muy abierta y solo se bloquean los servicios, ataques o conductas peligrosas conocidas. Requiere actualizaciones constantes para mantener la efectividad. 'Lo que no est√° expl√≠citamente prohibido, est√° permitido'." },
        prudente: { title: "Pol√≠tica Prudente", text: "Proporciona m√°xima seguridad permitiendo solo peligros conocidos pero necesarios. Bloquea todos los servicios y solo se habilitan los que son seguros o necesarios de manera individual. Todo se registra. 'Lo que no est√° expl√≠citamente permitido, est√° prohibido'." },
        paranoica: { title: "Pol√≠tica Paranoica", text: "Esta pol√≠tica lo proh√≠be todo. No se permite la conexi√≥n a internet, salvo que sea un uso aislado de la red principal y en un dispositivo severamente restringido. Es la m√°s segura, pero tambi√©n la m√°s restrictiva." }
    };
    const policyTabsContainer = document.getElementById('policy-tabs');
    const policyContentContainer = document.getElementById('policy-content');
    function updatePolicyContent(policyKey) {
        const content = policyContent[policyKey];
        policyContentContainer.innerHTML = `<h4 class="font-bold text-lg mb-2 text-teal-700">${content.title}</h4><p>${content.text}</p>`;
        policyTabsContainer.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.policy === policyKey) btn.classList.add('active');
        });
    }
    policyTabsContainer.addEventListener('click', (e) => { if (e.target.classList.contains('tab-button')) updatePolicyContent(e.target.dataset.policy); });
    updatePolicyContent('permisiva');

    const riskContent = {
        "risk-content-1": { title: "1. Identificar Activos y Amenazas", text: "El primer paso es conocer qu√© elementos de valor (activos) posee la organizaci√≥n (datos, servidores, personal) y a qu√© amenazas potenciales (ataques, desastres, errores) est√°n expuestos. Sin un inventario claro, es imposible proteger eficazmente." },
        "risk-content-2": { title: "2. Evaluar el Riesgo", text: "Se analiza la probabilidad de que una amenaza se materialice y el impacto que tendr√≠a en la organizaci√≥n. El riesgo se calcula a menudo como: <strong>Riesgo = Probabilidad x Impacto</strong>. Esto ayuda a priorizar los riesgos m√°s cr√≠ticos." },
        "risk-content-3": { title: "3. Tratar el Riesgo", text: "Una vez evaluado, se decide qu√© hacer: <strong>Mitigar</strong> (aplicar controles), <strong>Aceptar</strong> (asumir el riesgo), <strong>Transferir</strong> (contratar un seguro) o <strong>Evitar</strong> (eliminar la fuente del riesgo). La elecci√≥n depende del coste y el nivel de riesgo." },
        "risk-content-4": { title: "4. Monitorizar y Revisar", text: "La seguridad es un proceso din√°mico. Es crucial monitorizar continuamente los controles implementados y revisar peri√≥dicamente el an√°lisis de riesgos para adaptarlo a nuevos activos, amenazas y vulnerabilidades." }
    };
    const cycleSteps = document.querySelectorAll('.cycle-step');
    const riskContentArea = document.getElementById('risk-content-area');
    function updateRiskContent(contentId, activeStep) {
        const content = riskContent[contentId];
        riskContentArea.innerHTML = `<h4 class="font-bold text-xl mb-3 text-teal-700">${content.title}</h4><p class="text-stone-600">${content.text}</p>`;
        cycleSteps.forEach(step => step.classList.remove('active'));
        activeStep.classList.add('active');
    }
    cycleSteps.forEach(step => { step.addEventListener('click', () => { updateRiskContent(step.dataset.content, step); }); });
    updateRiskContent('risk-content-1', document.getElementById('step-1'));

    new Chart(document.getElementById('vulnerabilitiesChart').getContext('2d'), {
        type: 'doughnut',
        data: { labels: ['Configuraciones Err√≥neas', 'Falta de Actualizaciones', 'Errores de Dise√±o', 'Contrase√±as por Defecto', 'Otros'], datasets: [{ label: 'Causas de Vulnerabilidades', data: [35, 25, 15, 15, 10], backgroundColor: ['rgba(234, 179, 8, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(14, 165, 233, 0.8)', 'rgba(249, 115, 22, 0.8)', 'rgba(168, 162, 158, 0.8)'], borderColor: '#f5f5f4', borderWidth: 3 }] },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Distribuci√≥n de Causas Comunes' } } }
    });

    const cloudData = {
        labels: ['Datos y Acceso', 'Aplicaciones', 'Sistema Operativo', 'Virtualizaci√≥n', 'Servidores y Redes', 'Centro de Datos F√≠sico'],
        iaas: { description: "IaaS (Infraestructura como Servicio): M√°xima flexibilidad, m√°xima responsabilidad para el cliente. El proveedor gestiona solo la infraestructura f√≠sica.", data: { cliente: [100, 100, 100, 0, 0, 0], proveedor: [0, 0, 0, 100, 100, 100] } },
        paas: { description: "PaaS (Plataforma como Servicio): Un punto medio. El cliente gestiona sus aplicaciones y datos, el proveedor se encarga de la plataforma subyacente.", data: { cliente: [100, 100, 0, 0, 0, 0], proveedor: [0, 0, 100, 100, 100, 100] } },
        saas: { description: "SaaS (Software como Servicio): M√≠nima responsabilidad para el cliente. El proveedor gestiona casi todo; el cliente solo usa el software y gestiona sus datos.", data: { cliente: [100, 0, 0, 0, 0, 0], proveedor: [0, 100, 100, 100, 100, 100] } }
    };
    const cloudChart = new Chart(document.getElementById('cloudResponsibilityChart').getContext('2d'), {
        type: 'bar', data: { labels: cloudData.labels, datasets: [{ label: 'Responsabilidad del Cliente', data: [], backgroundColor: 'rgba(13, 148, 136, 0.7)' }, { label: 'Responsabilidad del Proveedor', data: [], backgroundColor: 'rgba(168, 162, 158, 0.7)' }] },
        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true, display: false }, y: { stacked: true, ticks: { font: { size: 10 } } } }, plugins: { legend: { position: 'top' }, title: { display: true, text: 'Modelo de Responsabilidad Compartida' }, tooltip: { enabled: false } } }
    });
    const cloudDescriptionEl = document.getElementById('cloud-description');
    function updateCloudChart(model) {
        cloudChart.data.datasets[0].data = cloudData[model].data.cliente;
        cloudChart.data.datasets[1].data = cloudData[model].data.proveedor;
        cloudChart.update();
        cloudDescriptionEl.textContent = cloudData[model].description;
        document.querySelectorAll('.cloud-btn').forEach(btn => { btn.classList.remove('bg-teal-600', 'text-white'); btn.classList.add('text-teal-600'); });
        document.getElementById(`${model}-btn`).classList.add('bg-teal-600', 'text-white');
        document.getElementById(`${model}-btn`).classList.remove('text-teal-600');
    }
    document.getElementById('iaas-btn').addEventListener('click', () => updateCloudChart('iaas'));
    document.getElementById('paas-btn').addEventListener('click', () => updateCloudChart('paas'));
    document.getElementById('saas-btn').addEventListener('click', () => updateCloudChart('saas'));
    updateCloudChart('iaas');

    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); });
    const navLinks = document.querySelectorAll('.nav-link, #mobile-menu a');
    const sections = document.querySelectorAll('main section');
    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
            if (pageYOffset >= section.offsetTop - 100) { current = section.getAttribute('id'); }
        });
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href')?.substring(1) === current) { link.classList.add('active'); }
        });
    });

    // #################### L√ìGICA DEL LABORATORIO ####################
    const labFeedback = document.getElementById('lab-feedback');
    document.querySelectorAll('.email-red-flag').forEach(flag => {
        flag.addEventListener('click', () => {
            labFeedback.textContent = flag.dataset.feedback;
            labFeedback.classList.remove('hidden', 'bg-green-200', 'text-green-800', 'bg-red-200', 'text-red-800');
            labFeedback.classList.add('bg-yellow-200', 'text-yellow-800');
            labFeedback.style.display = 'block';
        });
    });

    const labQuestions = [
        {
            question: "Si un empleado introduce sus credenciales en el enlace falso, ¬øqu√© pilar de la Tr√≠ada CIA se compromete principalmente?",
            options: ["Disponibilidad", "Integridad", "Confidencialidad"],
            correct: 2,
            feedback: "Correcto. La confidencialidad se rompe porque las credenciales (informaci√≥n secreta) son expuestas a un actor no autorizado."
        },
        {
            question: "La falta de formaci√≥n del empleado sobre phishing, ¬øse considera una amenaza o una vulnerabilidad?",
            options: ["Amenaza", "Vulnerabilidad"],
            correct: 1,
            feedback: "Exacto. Es una vulnerabilidad. Es una debilidad interna (falta de conocimiento) que puede ser explotada por una amenaza externa (el email de phishing)."
        },
        {
            question: "Para evitar que un posible malware descargado por el enlace se ejecute, ¬øqu√© pol√≠tica de seguridad ser√≠a la m√°s efectiva?",
            options: ["Permisiva", "Prudente", "Paranoica"],
            correct: 1,
            feedback: "Bien analizado. La pol√≠tica Prudente ('lo que no est√° expl√≠citamente permitido, est√° prohibido') impedir√≠a la ejecuci√≥n de un software no autorizado por defecto. La Paranoica tambi√©n, pero es demasiado restrictiva para la mayor√≠a de los casos."
        }
    ];
    let currentQuestionIndex = 0;
    const questionArea = document.getElementById('lab-question-area');

    function loadQuestion(index) {
        const q = labQuestions[index];
        questionArea.innerHTML = `
            <p class="mb-4 text-stone-300">${index + 1}. ${q.question}</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${q.options.map((opt, i) => `<button data-index="${i}" class="lab-option w-full text-center px-4 py-3 border-2 border-stone-500 rounded-lg font-semibold hover:bg-stone-700">${opt}</button>`).join('')}
            </div>
        `;
    }

    questionArea.addEventListener('click', e => {
        if (e.target.classList.contains('lab-option')) {
            const selectedIndex = parseInt(e.target.dataset.index);
            const question = labQuestions[currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;

            labFeedback.textContent = question.feedback;
            labFeedback.classList.remove('hidden', 'bg-yellow-200', 'text-yellow-800');
            if (isCorrect) {
                labFeedback.classList.add('bg-green-200', 'text-green-800');
            } else {
                labFeedback.classList.add('bg-red-200', 'text-red-800');
            }
            labFeedback.style.display = 'block';
            
            // Marcar opciones
            questionArea.querySelectorAll('.lab-option').forEach((btn, i) => {
                btn.disabled = true;
                if(i === question.correct) btn.classList.add('correct');
                else if (i === selectedIndex) btn.classList.add('incorrect');
            });

            // Cargar siguiente pregunta o finalizar
            currentQuestionIndex++;
            if (currentQuestionIndex < labQuestions.length) {
                setTimeout(() => loadQuestion(currentQuestionIndex), 2500);
            } else {
                setTimeout(() => {
                    questionArea.innerHTML = `<p class="text-center font-bold text-lg text-yellow-400">An√°lisis completado. Has neutralizado la amenaza. Prep√°rate para el siguiente incidente.</p>`;
                }, 2500);
            }
        }
    });
    
    loadQuestion(0);
});
</script>
</body>
</html>

