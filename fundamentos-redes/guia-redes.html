<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Mando de Redes v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-box-and-violin-plot@4.3.0/build/index.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f4; color: #1c1917; }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        .nav-link { transition: color 0.3s, border-bottom-color 0.3s; }
        .nav-link:hover, .nav-link.active { color: #0d9488; border-bottom-color: #0d9488; }
        .strategic-insight { border-left: 4px solid #0d9488; background-color: #f0fdfa; }
        .accordion-button { transition: background-color 0.2s; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .packet-part { opacity: 0; transform: translateX(-20px); transition: opacity 0.5s ease, transform 0.5s ease; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #e2e8f0; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="antialiased">

    <header class="bg-stone-100 shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-teal-700">Centro de Mando PEC1</h1>
            <div class="hidden md:flex space-x-6 text-sm font-semibold">
                <a href="#briefing" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Briefing</a>
                <a href="#lab-conceptos" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Conceptos</a>
                <a href="#lab-packet-tracer" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Packet Tracer</a>
                <a href="#lab-rendimiento" class="nav-link text-stone-600 border-b-2 border-transparent pb-1">Rendimiento</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-stone-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg">
            <!-- Mobile nav links here -->
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">

        <section id="briefing" class="text-center mb-20">
            <h2 class="text-4xl font-bold text-stone-800 mb-4">Módulo de Operaciones de Red</h2>
            <p class="text-lg text-stone-600 max-w-3xl mx-auto">
                Este centro de mando unificado contiene toda la inteligencia y las herramientas interactivas necesarias para ejecutar la misión PEC1 con la máxima eficiencia.
            </p>
        </section>

        <!-- #################### LABORATORIO: CONCEPTOS #################### -->
        <section id="lab-conceptos" class="mb-20 space-y-12">
            <h2 class="text-3xl font-bold text-center text-stone-800">PARTE 1: FUNDAMENTOS Y CONCEPTOS</h2>
            <!-- Ejercicio 1-5 Módulos -->
            <div id="ej1-container"></div>
            <div id="ej2-container"></div>
            <div id="ej3-container"></div>
            <div id="ej4-container"></div>
            <div id="ej5-container"></div>
        </section>

        <!-- #################### LABORATORIO: PACKET TRACER #################### -->
        <section id="lab-packet-tracer" class="mb-20">
             <div class="bg-gray-800 text-white p-6 sm:p-8 rounded-lg shadow-2xl">
                <h2 class="text-3xl font-bold text-center text-sky-400 mb-2 font-mono">PARTE 2 :: GUÍA DE CAMPO PACKET TRACER</h2>
                <p class="text-center text-stone-300 mb-10">Inteligencia y directrices para los ejercicios 6 al 13.</p>
                <div id="packet-tracer-accordion" class="space-y-4">
                    <!-- Accordion items for Ej 6-13 will be injected here -->
                </div>
            </div>
        </section>

        <!-- #################### LABORATORIO: RENDIMIENTO #################### -->
        <section id="lab-rendimiento" class="mb-20 space-y-12">
            <h2 class="text-3xl font-bold text-center text-stone-800">PARTE 3: ANÁLISIS DE RENDIMIENTO</h2>
            <!-- Ejercicio 14-15 Módulos -->
            <div id="ej14-container"></div>
            <div id="ej15-container"></div>
        </section>

    </main>
    
    <footer class="bg-stone-200 mt-20">
        <div class="container mx-auto px-6 py-4 text-center text-stone-600">
            <p class="text-xs">&copy; 2025 Centro de Mando de Redes. Todos los sistemas nominales.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    document.querySelectorAll('header .hidden.md\\:flex a').forEach(link => {
        const clone = link.cloneNode(true);
        clone.className = 'block py-3 px-6 text-sm hover:bg-stone-200';
        mobileMenu.appendChild(clone);
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').substring(1) === entry.target.id) {
                        link.classList.add('active');
                    }
                });
            }
        });
    }, { rootMargin: '-50% 0px -50% 0px' });
    document.querySelectorAll('main section').forEach(section => observer.observe(section));

    // #################### DATA FOR MODULES ####################
    const createModule = (id, title, content) => {
        const container = document.getElementById(id);
        container.innerHTML = `<div class="bg-white p-6 sm:p-8 rounded-lg shadow-lg">${title}${content}</div>`;
    };

    // --- EJERCICIO 1 ---
    createModule('ej1-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 1: Orígenes de Internet</h3>`,
        `<p class="text-stone-600 mb-6">La red moderna es el resultado de décadas de evolución. A continuación se presentan los hitos que la definieron.</p>
         <div class="grid md:grid-cols-3 gap-6 text-center">
            <div class="bg-stone-50 p-4 rounded-md border-t-4 border-teal-500">
                <h4 class="font-bold">ARPANET (1960s)</h4>
                <p class="text-sm mt-1">Nace con un objetivo militar: crear una red <strong>descentralizada y tolerante a fallos.</strong></p>
            </div>
            <div class="bg-stone-50 p-4 rounded-md border-t-4 border-sky-500">
                <h4 class="font-bold">TCP/IP & E-mail (1970s-83)</h4>
                <p class="text-sm mt-1">Se crea el <strong>lenguaje universal</strong> de Internet (TCP/IP) y su primera "killer app" (e-mail).</p>
            </div>
            <div class="bg-stone-50 p-4 rounded-md border-t-4 border-rose-500">
                <h4 class="font-bold">WWW (1990s)</h4>
                <p class="text-sm mt-1">Tim Berners-Lee inventa el <strong>hipertexto (HTTP, HTML)</strong>, haciendo la red accesible al público.</p>
            </div>
         </div>`
    );

    // --- EJERCICIO 2 ---
    createModule('ej2-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 2: Anatomía de una Red Doméstica</h3>`,
        `<div class="strategic-insight p-4 rounded-lg">
            <p class="text-stone-700 text-sm">Tu red doméstica es una topología en estrella. El router del ISP es el centro, actuando como Módem, Router, Switch y AP WiFi. Los dispositivos finales (PCs, móviles) se conectan a él para formar la Red de Área Local (LAN) y acceder a Internet (WAN).</p>
        </div>`
    );

    // --- EJERCICIO 3 ---
    createModule('ej3-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 3: Simulador de Encapsulación</h3>`,
        `<p class="text-stone-600 text-center mb-4">Pulsa para ver cómo se construye una Trama Ethernet, capa por capa.</p>
        <div class="font-mono text-sm space-y-2 p-4 border rounded-md bg-stone-50 min-h-[240px]">
            <div id="part-trama" class="packet-part flex items-center">
                <span class="bg-purple-600 text-white font-bold py-2 px-3 rounded-l-md">H_Enlace (MACs)</span>
                <div class="border p-2 rounded-r-md bg-white w-full text-stone-400">...</div>
            </div>
            <div id="part-datagrama" class="packet-part flex items-center ml-5">
                <span class="bg-red-600 text-white font-bold py-2 px-3 rounded-l-md">H_Red (IPs)</span>
                <div class="border p-2 rounded-r-md bg-white w-full text-stone-400">...</div>
            </div>
            <div id="part-segmento" class="packet-part flex items-center ml-10">
                <span class="bg-green-600 text-white font-bold py-2 px-3 rounded-l-md">H_Transp (Puertos)</span>
                 <div class="border p-2 rounded-r-md bg-white w-full text-stone-400">...</div>
            </div>
             <div id="part-mensaje" class="packet-part flex items-center ml-16">
                <span class="bg-blue-600 text-white font-bold py-2 px-3 rounded-md w-full text-center">Mensaje ("23")</span>
            </div>
        </div>
        <div class="text-center mt-4">
            <button id="encapsulate-btn" class="bg-teal-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-teal-700 transition">Encapsular</button>
        </div>`
    );
    const encapsulateBtn = document.getElementById('encapsulate-btn');
    const packetParts = document.querySelectorAll('.packet-part');
    encapsulateBtn.addEventListener('click', () => {
        packetParts.forEach(part => { part.style.opacity = 0; part.style.transform = 'translateX(-20px)'; });
        let delay = 100;
        ['part-mensaje', 'part-segmento', 'part-datagrama', 'part-trama'].forEach(id => {
            setTimeout(() => {
                const el = document.getElementById(id);
                el.style.opacity = 1; el.style.transform = 'translateX(0)';
            }, delay);
            delay += 300;
        });
    });

    // --- EJERCICIO 4 ---
    createModule('ej4-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 4: Señales y Ancho de Banda</h3>`,
        `<div class="strategic-insight p-4 rounded-lg mb-6"><p class="text-stone-700 text-sm">Más velocidad → bits más cortos → cambios de señal más rápidos → se necesitan frecuencias más altas → se consume más ancho de banda.</p></div>
         <canvas id="signal-canvas" height="100" class="w-full bg-slate-50 border rounded-lg"></canvas>
         <div class="mt-4 flex justify-center space-x-4">
            <button id="draw-low-speed" class="bg-stone-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-stone-700">Baja Velocidad (bits anchos)</button>
            <button id="draw-high-speed" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700">Alta Velocidad (bits estrechos)</button>
         </div>`
    );
    const canvas = document.getElementById('signal-canvas');
    const ctxSignal = canvas.getContext('2d');
    const drawSignal = (bitWidth) => {
        const w = canvas.width, h = canvas.height, midY = h / 2, amp = h / 3;
        ctxSignal.clearRect(0, 0, w, h); ctxSignal.strokeStyle = '#0d9488'; ctxSignal.lineWidth = 3; ctxSignal.beginPath(); ctxSignal.moveTo(0, midY);
        let level = 1;
        for (let x = 0; x < w; x += bitWidth) {
            const y = midY - (level * amp);
            ctxSignal.lineTo(x, y); ctxSignal.lineTo(x + bitWidth, y);
            level *= -1;
        }
        ctxSignal.stroke();
    };
    document.getElementById('draw-low-speed').addEventListener('click', () => drawSignal(80));
    document.getElementById('draw-high-speed').addEventListener('click', () => drawSignal(20));
    drawSignal(80);

    // --- EJERCICIO 5 ---
    createModule('ej5-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 5: Atenuación WiFi (FSPL)</h3>`,
        `<div class="strategic-insight p-4 rounded-lg mb-6"><p class="text-stone-700 text-sm"><strong>Trade-off:</strong> 2.4 GHz tiene más alcance (menor atenuación), pero 5 GHz ofrece más velocidad y menos interferencia a corta distancia gracias a sus canales más limpios y anchos.</p></div>
        <canvas id="fspl-chart"></canvas>`
    );
    const ctxFspl = document.getElementById('fspl-chart');
    const distances = Array.from({length: 100}, (_, i) => i + 1);
    const calculateFSPL = (d, f) => 20 * Math.log10(d) + 20 * Math.log10(f) - 147.55;
    new Chart(ctxFspl, {
        type: 'line',
        data: { labels: distances, datasets: [ { label: 'Pérdida a 2.4 GHz (dB)', data: distances.map(d => calculateFSPL(d, 2.4e9)), borderColor: 'rgb(59, 130, 246)', tension: 0.1 }, { label: 'Pérdida a 5 GHz (dB)', data: distances.map(d => calculateFSPL(d, 5e9)), borderColor: 'rgb(239, 68, 68)', tension: 0.1 } ] },
        options: { responsive: true, plugins: { title: { display: true, text: 'Pérdida de Señal (FSPL) vs. Distancia' } }, scales: { x: { title: { display: true, text: 'Distancia (m)' } }, y: { title: { display: true, text: 'Pérdida (dB)' } } } }
    });

    // --- PACKET TRACER ACCORDION ---
    const ptAccordion = document.getElementById('packet-tracer-accordion');
    const ptData = [
        { title: "Ej. 6: Vista Física", content: `<strong>1. Mover Nodos:</strong> Arrastra los clusters en el mapa.<br><strong>2. Describir Dispositivos:</strong> Usa Shift+N para ver Routers, Switches, etc.<br><strong>3. Montar Rack:</strong> En un DC, arrastra un Rack y luego los dispositivos a él.<br><strong>4. DC Real:</strong> No olvides la refrigeración, energía redundante y seguridad física.` },
        { title: "Ej. 7: Análisis de Topología", content: `La topología del núcleo es de <strong>malla parcial (distribuida)</strong>, pero las conexiones de los DC y tu hogar son en <strong>estrella (centralizada)</strong>. Los routers de borde son puntos únicos de fallo. Mejora: <strong>redundancia (multihoming)</strong>.` },
        { title: "Ej. 8: Hub/Repetidor", content: `Un Hub es un dispositivo de Capa 1 obsoleto. Su función es <strong>regenerar la señal</strong> para extender la distancia. En redes reales no se usa; se prefiere un switch.` },
        { title: "Ej. 9: Conexión Directa", content: `Para conectar dos PCs directamente se necesita un <strong>cable cruzado (crossover)</strong> para que el pin de transmisión (TX) de uno conecte con el de recepción (RX) del otro.` },
        { title: "Ej. 10 y 11: Configuración RIP", content: `RIP es un protocolo de enrutamiento simple. Debes usar el comando <code>network &lt;red&gt;</code> en el modo <code>router rip</code> para que el router "anuncie" las redes que tiene directamente conectadas a sus vecinos.` },
        { title: "Ej. 12: Análisis de Paquetes", content: `¡Concepto clave! Al simular un ping, fíjate que las <strong>direcciones MAC (Capa 2) cambian en cada salto</strong>, mientras que las <strong>direcciones IP (Capa 3) de origen y destino NUNCA cambian</strong>.` }
    ];
    ptData.forEach(item => {
        const div = document.createElement('div');
        div.innerHTML = `
            <button class="accordion-button bg-gray-700 hover:bg-gray-600 text-left w-full p-4 rounded-md font-bold text-lg text-sky-300 flex justify-between items-center">
                <span>${item.title}</span>
                <svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div class="accordion-content bg-gray-900 text-stone-300 p-4 rounded-b-md">
                <p class="text-sm">${item.content}</p>
            </div>
        `;
        ptAccordion.appendChild(div);
        const button = div.querySelector('button');
        const content = div.querySelector('.accordion-content');
        button.addEventListener('click', () => {
            const isOpen = content.style.maxHeight;
            document.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
            document.querySelectorAll('.accordion-button svg').forEach(svg => svg.style.transform = '');
            if (!isOpen) {
                content.style.maxHeight = content.scrollHeight + "px";
                button.querySelector('svg').style.transform = 'rotate(180deg)';
            }
        });
    });

    // --- EJERCICIO 14 ---
     createModule('ej14-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 14: Calculadora de Retardo (Stop-and-Wait)</h3>`,
        `<div class="strategic-insight p-4 rounded-lg mb-6"><p class="text-stone-700 text-sm">El tiempo total es el Nº de Paquetes multiplicado por el RTT de cada uno. Las retransmisiones por errores (BER) aumentan este tiempo drásticamente.</p></div>
        <div class="bg-slate-50 p-6 rounded-lg border">
            <h4 class="font-semibold text-lg mb-4 text-center">Calculadora de Simulación</h4>
            <div class="grid md:grid-cols-2 gap-6 items-center">
                <div class="space-y-4">
                    <div><label class="font-medium text-sm">Tamaño Archivo (GB): <input id="fileSize" type="number" value="10" class="w-full mt-1 p-2 border rounded-md"></label></div>
                    <div><label class="font-medium text-sm">Nº Saltos (h): <input id="hops" type="number" value="5" class="w-full mt-1 p-2 border rounded-md"></label></div>
                    <div><label class="font-medium text-sm">BER (ej. 0.0001): <input id="ber" type="number" step="0.00001" value="0.0001" class="w-full mt-1 p-2 border rounded-md"></label></div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-inner space-y-3 font-mono text-sm">
                    <h5 class="font-bold text-center text-base">Resultados</h5>
                    <p><strong>Nº Paquetes:</strong> <span id="res-packets" class="font-bold text-teal-700"></span></p>
                    <p><strong>RTT (ideal):</strong> <span id="res-rtt" class="font-bold text-teal-700"></span> ms</p>
                    <p><strong>Retardo Total (sin BER):</strong> <span id="res-total-ideal" class="font-bold text-green-600"></span></p>
                    <p><strong>Retardo Total (con BER):</strong> <span id="res-total-ber" class="font-bold text-red-600"></span></p>
                </div>
            </div>
            <div class="mt-4 text-center"><button id="calculate-delay" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700">Calcular</button></div>
        </div>`
    );
    const calculateDelayBtn = document.getElementById('calculate-delay');
    const calculateAndDisplayDelay = () => {
        const fileSizeGB = parseFloat(document.getElementById('fileSize').value), mtuBytes = 1500, headersBytes = 54, linkSpeedMbps = 10;
        const h = parseFloat(document.getElementById('hops').value), ber = parseFloat(document.getElementById('ber').value) || 0;
        const dataPerPacketBytes = mtuBytes - headersBytes;
        const totalPackets = Math.ceil((fileSizeGB * 1e9) / dataPerPacketBytes);
        const linkSpeedBps = linkSpeedMbps * 1e6, tTransData = (mtuBytes * 8) / linkSpeedBps, tTransAck = (headersBytes * 8) / linkSpeedBps, tProp = 1000 / 2e8;
        const RTT = ((h + 1) * tTransData) + ((h + 1) * tTransAck) + (2 * (h+1) * tProp); // Corrected: propagation happens on all h+1 links
        const totalIdealDelay = totalPackets * RTT;
        
        document.getElementById('res-packets').textContent = totalPackets.toLocaleString();
        document.getElementById('res-rtt').textContent = (RTT * 1000).toFixed(4);
        
        const formatTime = s => s < 60 ? `${s.toFixed(2)}s` : s < 3600 ? `${(s/60).toFixed(2)}m` : `${(s/3600).toFixed(2)}h`;
        document.getElementById('res-total-ideal').textContent = formatTime(totalIdealDelay);

        if (ber > 0) {
            const avgTransmissions = 1 / Math.pow(Math.pow(1 - ber, mtuBytes * 8), h + 1);
            document.getElementById('res-total-ber').textContent = formatTime(totalPackets * avgTransmissions * RTT);
        } else {
            document.getElementById('res-total-ber').textContent = formatTime(totalIdealDelay);
        }
    };
    calculateDelayBtn.addEventListener('click', calculateAndDisplayDelay);
    calculateAndDisplayDelay();

    // --- EJERCICIO 15 ---
    createModule('ej15-container',
        `<h3 class="text-2xl font-bold text-stone-800 mb-4">Ejercicio 15: Analizador de Ping</h3>`,
        `<div class="strategic-insight p-4 rounded-lg mb-6"><p class="text-stone-700 text-sm"><strong>Jitter</strong> (desviación estándar de RTTs) mide la estabilidad. Un <strong>Boxplot</strong> ancho o una <strong>PDF</strong> dispersa indican alto jitter y una conexión inestable.</p></div>
        <div class="grid lg:grid-cols-2 gap-6">
            <div>
                <h4 class="font-semibold text-lg mb-2">Pega aquí tus 100 RTTs (en ms):</h4>
                <textarea id="ping-data" rows="10" class="w-full p-2 border rounded-md font-mono text-sm custom-scrollbar" placeholder="34.5\n35.1\n34.8..."></textarea>
                <button id="analyze-ping" class="bg-teal-600 mt-2 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700">Analizar Datos</button>
            </div>
            <div class="bg-slate-50 p-4 rounded-lg border space-y-2"><h4 class="font-semibold text-lg text-center">Resultados Estadísticos</h4>
                <p><strong>Media RTT:</strong> <span id="ping-avg" class="font-mono font-bold text-teal-700"></span> ms</p>
                <p><strong>Jitter (StdDev):</strong> <span id="ping-jitter" class="font-mono font-bold text-teal-700"></span> ms</p>
                <p><strong>Min/Max RTT:</strong> <span id="ping-minmax" class="font-mono font-bold text-teal-700"></span> ms</p>
            </div>
        </div>
        <div class="mt-6"><h4 class="font-semibold text-lg mb-2 text-center">Gráficas de Distribución</h4><div class="grid md:grid-cols-3 gap-4"><canvas id="ping-boxplot-chart"></canvas><canvas id="ping-pdf-chart"></canvas><canvas id="ping-cdf-chart"></canvas></div></div>`
    );
    let charts = {};
    document.getElementById('analyze-ping').addEventListener('click', () => {
        const data = document.getElementById('ping-data').value.trim().split(/\s+/).map(Number).filter(n => !isNaN(n) && n > 0);
        if (data.length === 0) return;
        const n = data.length, sum = data.reduce((a, b) => a + b, 0), mean = sum / n;
        const stddev = Math.sqrt(data.reduce((a, b) => a + (b - mean) ** 2, 0) / n);
        document.getElementById('ping-avg').textContent = mean.toFixed(2);
        document.getElementById('ping-jitter').textContent = stddev.toFixed(2);
        document.getElementById('ping-minmax').textContent = `${Math.min(...data).toFixed(2)} / ${Math.max(...data).toFixed(2)}`;
        
        if(charts.boxplot) charts.boxplot.destroy();
        charts.boxplot = new Chart(document.getElementById('ping-boxplot-chart'), { type: 'boxplot', data: { labels: ['RTT'], datasets: [{ data: [data], backgroundColor: 'rgba(13, 148, 136, 0.5)', borderColor: 'rgb(13, 148, 136)' }] }, options: { plugins: { title: {display: true, text: 'Boxplot'} } } });
        
        const binSize = stddev / 2 || 1, bins = {};
        data.forEach(v => { const bin = Math.floor(v/binSize)*binSize; bins[bin] = (bins[bin]||0)+1; });
        const labels = Object.keys(bins).map(Number).sort((a,b)=>a-b);
        const pdfData = labels.map(l => (bins[l]/n)/binSize);
        if(charts.pdf) charts.pdf.destroy();
        charts.pdf = new Chart(document.getElementById('ping-pdf-chart'), { type: 'bar', data: { labels: labels.map(l=>l.toFixed(1)), datasets: [{ label: 'PDF', data: pdfData, backgroundColor: 'rgba(239, 68, 68, 0.5)' }] }, options: { plugins: { title: {display: true, text: 'PDF'} } } });
        
        const cdfData = []; let cum = 0;
        labels.forEach((l, i) => { cum += pdfData[i]*binSize; cdfData.push(cum); });
        if(charts.cdf) charts.cdf.destroy();
        charts.cdf = new Chart(document.getElementById('ping-cdf-chart'), { type: 'line', data: { labels: labels.map(l=>l.toFixed(1)), datasets: [{ label: 'CDF', data: cdfData, borderColor: 'rgb(22, 163, 74)', stepped: true }] }, options: { plugins: { title: {display: true, text: 'CDF'} } } });
    });
});
</script>
</body>
</html>

